<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacoRocko - Reference Crash Game (EXACT SYNC)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #FFD700;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #888;
            font-size: 1rem;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .multiplier-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .multiplier-display {
            background: #000;
            border: 3px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .multiplier-value {
            font-size: 4rem;
            font-weight: bold;
            color: #00FF00;
            transition: all 0.1s ease;
        }

        .multiplier-value.crashed {
            color: #FF4444;
            animation: crash-flash 0.5s ease-in-out;
        }

        @keyframes crash-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .game-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .connection-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .connection-status.connected {
            background: #00AA00;
            color: white;
        }

        .connection-status.disconnected {
            background: #AA0000;
            color: white;
        }

        .betting-timer {
            background: #FFD700;
            color: #000;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
        }

        .betting-timer.hidden {
            display: none;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel, .right-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
        }

        .section-title {
            color: #FFD700;
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 5px;
        }

        .crash-history {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .crash-value {
            background: #333;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .crash-value.high {
            background: #00AA00;
            color: white;
        }

        .crash-value.low {
            background: #AA0000;
            color: white;
        }

        .betting-table {
            max-height: 300px;
            overflow-y: auto;
        }

        .bet-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .bet-row.live {
            border-left: 3px solid #FFD700;
        }

        .bet-row.completed {
            opacity: 0.7;
        }

        .profit.positive {
            color: #00FF00;
        }

        .profit.negative {
            color: #FF4444;
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            color: #FFD700;
            font-weight: bold;
        }

        .control-group input {
            background: #333;
            color: white;
            border: 2px solid #555;
            border-radius: 5px;
            padding: 10px;
            font-size: 1rem;
            width: 150px;
        }

        .control-group input:focus {
            border-color: #FFD700;
            outline: none;
        }

        .btn {
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 5px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #FFF700;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
        }

        .btn.danger {
            background: #FF4444;
            color: white;
        }

        .btn.danger:hover {
            background: #FF6666;
        }

        .debug-info {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            border: 1px solid #444;
        }

        .debug-info h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }

        .debug-info pre {
            color: #888;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }

            .multiplier-value {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêî PacoRocko</h1>
        <div class="subtitle">Reference Implementation - Perfect Sync</div>
    </div>

    <div class="game-container">
        <!-- Multiplier Display -->
        <div class="multiplier-section">
            <div class="multiplier-display">
                <div id="multiplierValue" class="multiplier-value">CONNECTING...</div>
            </div>
            
            <div class="game-status">
                <div>
                    <strong>Status:</strong> <span id="gameStatus">Connecting</span>
                </div>
                <div id="connectionStatus" class="connection-status disconnected">DISCONNECTED</div>
                <div id="bettingTimer" class="betting-timer hidden">Betting: 0s</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel: Crash History -->
            <div class="left-panel">
                <h3 class="section-title">üìä Crash History</h3>
                <div id="crashHistory" class="crash-history">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Right Panel: Live Bets -->
            <div class="right-panel">
                <h3 class="section-title">üìã Live Bets</h3>
                <div class="bet-row" style="font-weight: bold; background: #444;">
                    <div>Player</div>
                    <div>Bet</div>
                    <div>Multiplier</div>
                    <div>Profit</div>
                </div>
                <div id="bettingTable" class="betting-table">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <label for="betAmount">Bet Amount (ETH)</label>
                <input type="number" id="betAmount" value="0.01" min="0.001" step="0.001">
            </div>
            
            <div class="control-group">
                <label for="payoutMultiplier">Auto Cash Out</label>
                <input type="number" id="payoutMultiplier" value="2.00" min="1.01" step="0.01">
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button id="placeBetBtn" class="btn">Place Bet</button>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button id="cashOutBtn" class="btn danger" disabled>Cash Out</button>
            </div>
        </div>

        <!-- Debug Info -->
        <div class="debug-info">
            <h3>üîß Debug Info (Reference Implementation)</h3>
            <pre id="debugInfo">Initializing reference crash client...</pre>
        </div>
    </div>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <!-- Reference Crash Client -->
    <script src="js/reference-crash-client.js"></script>
    
    <!-- Main App -->
    <script>
        // Initialize reference crash client
        let referenceCrashClient = null;
        let currentBet = null;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üé∞ Initializing Reference Crash Game (EXACT SYNC)');
            
            referenceCrashClient = new ReferenceCrashClient();
            setupEventHandlers();
            
            updateDebugInfo('Reference crash client initialized\nUsing EXACT events from working repo');
        });

        // Setup UI event handlers
        function setupEventHandlers() {
            // Place bet button
            document.getElementById('placeBetBtn').addEventListener('click', async () => {
                const betAmount = parseFloat(document.getElementById('betAmount').value);
                const payoutMultiplier = parseFloat(document.getElementById('payoutMultiplier').value);
                
                if (betAmount <= 0 || payoutMultiplier < 1.01) {
                    alert('Invalid bet amount or multiplier');
                    return;
                }
                
                const result = await referenceCrashClient.placeBet(betAmount, payoutMultiplier);
                
                if (result.success) {
                    currentBet = { amount: betAmount, multiplier: payoutMultiplier };
                    document.getElementById('placeBetBtn').disabled = true;
                    document.getElementById('cashOutBtn').disabled = false;
                    updateDebugInfo(`Bet placed: ${betAmount} ETH @ ${payoutMultiplier}x`);
                } else {
                    alert(`Failed to place bet: ${result.error}`);
                }
            });

            // Cash out button
            document.getElementById('cashOutBtn').addEventListener('click', async () => {
                const result = await referenceCrashClient.cashOut();
                
                if (result.success) {
                    const profit = currentBet ? (currentBet.amount * result.multiplier) - currentBet.amount : 0;
                    updateDebugInfo(`Cashed out at ${result.multiplier}x - Profit: ${profit.toFixed(4)} ETH`);
                    resetBetUI();
                } else {
                    alert(`Failed to cash out: ${result.error}`);
                }
            });

            // Reset bet UI when round ends
            setInterval(() => {
                if (currentBet && !referenceCrashClient.betActive) {
                    resetBetUI();
                }
            }, 1000);
        }

        // Reset betting UI
        function resetBetUI() {
            currentBet = null;
            document.getElementById('placeBetBtn').disabled = false;
            document.getElementById('cashOutBtn').disabled = true;
        }

        // Update debug info
        function updateDebugInfo(message) {
            const debugElement = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugElement.textContent = `[${timestamp}] ${message}`;
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (referenceCrashClient) {
                referenceCrashClient.disconnect();
            }
        });
    </script>
</body>
</html>
